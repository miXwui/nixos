# NixOS Configurations

## Install a specific version of a package

Find details from <https://lazamar.co.uk/nix-versions/> or search the Git repo for the PR/commit.

Then modify `hosts/home.nix` like so:

```nix
let
  old = import (builtins.fetchGit {
    name = "waybar-old";
    url = "https://github.com/NixOS/nixpkgs/";
    ref = "refs/heads/nixpkgs-unstable";
    rev = "db92283eff575ac2a78d7b2d65d2dad4f7acf14a";
  }) { system = "x86_64-linux"; };
in
{
  home.packages = with pkgs; [
    old.waybar
  ]
}
```

## Build ISO

`flake.nix` is set up to use [nixos-generators](https://github.com/nix-community/nixos-generators):

```sh
nix build .#iso
```

[This](https://www.reddit.com/r/NixOS/comments/18gkafh/comment/kd13m58/) also works if added to `flake.nix`:

```nix
{
  nixosConfigurations = {
    live-image = nixpkgs.lib.nixosSystem {
      specialArgs = { inherit inputs; };
      modules = [
        (nixpkgs + "/nixos/modules/installer/cd-dvd/installation-cd-minimal.nix")
        ./hosts/live-image/configuration.nix
        inputs.home-manager.nixosModules.default
        { nixpkgs.overlays = overlays; }
      ];
    };
};
}
```

```sh
nix build .#nixosConfigurations.live-image.config.system.build.isoImage
```

## Search packages

```sh
nix-search <package name>
```

## Keyring

- `hosts/base.nix`
- `modules/home-manager/keyring.nix`

We use Gnome Keyring for `pkcs11` and `secrets`. We use `gcr` for SSH since [that functionality has been moved there](https://gitlab.gnome.org/GNOME/gnome-keyring/-/merge_requests/60).

Seahorse (Passwords and Keys) is also installed.

## Fingerprint

User files are stored under `/var/lib/fprint/<user>` which can be migrated to another installation ([ref](https://community.frame.work/t/cross-distro-dualboot-and-or-reinstall-save-your-var-lib-fprint-user-files-from-the-one-that-works/12908/2)).\
The actual fingerprints for Framework 13 apparently are stored directly on the sensor.
